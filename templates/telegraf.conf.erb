# THIS FILE IS MANAGED BY PUPPET (created by defined type modules::telegraf )

# Telegraf configuration

# If this file is missing an [agent] section, you must first generate a
# valid config with 'telegraf -sample-config > telegraf.toml'

# Telegraf is entirely plugin driven. All metrics are gathered from the
# declared plugins.

# Even if a plugin has no configuration, it must be declared in here
# to be active. Declaring a plugin means just specifying the name
# as a section with no variables. To deactivate a plugin, comment
# out the name and any variables.

# Use 'telegraf -config telegraf.toml -test' to see what metrics a config
# file would generate.

# One rule that plugins conform to is wherever a connection string
# can be passed, the values '' and 'localhost' are treated specially.
# They indicate to the plugin to use their own builtin configuration to
# connect to the local system.

# NOTE: The configuration has a few required parameters. They are marked
# with 'required'. Be sure to edit those to make this configuration work.

# OUTPUTS
[outputs]

# Configuration for influxdb server to send metrics to
[outputs.influxdb]
# The full HTTP endpoint URL for your InfluxDB instance
# url = "http://localhost:8086" # required.
url = "<%= @outputs_influxdb_url %>"

# The target database for metrics. This database must already exist
# database = "telegraf" # required.
database = "<%= @outputs_influxdb_database %>"

# Connection timeout (for the connection with InfluxDB), formatted as a string.
# Valid time units are "ns", "us" (or "Âµs"), "ms", "s", "m", "h".
# If not provided, will default to 0 (no timeout)
# timeout = "5s"

# username = "telegraf"
# password = "metricsmetricsmetricsmetrics"
username = "<%= @outputs_influxdb_username %>"
password = "<%= @outputs_influxdb_password %>"

# Set the user agent for the POSTs (can be useful for log differentiation)
# user_agent = "telegraf"
user_agent = "telegraf <%= @version %>"

# Tags can also be specified via a normal map, but only one form at a time:

# [tags]
# dc = "us-east-1"
<% if @tags -%>
[tags]
<%   @tags.each do |key, value| -%>
<%= key %> = "<%= value %>"
<%   end -%>
<% end -%>

# Configuration for telegraf itself
# [agent]
# interval = "10s"
# debug = false
# hostname = "prod3241"

[agent]
interval = "10s"
hostname = "<%= @hostname %>"

# PLUGINS
<% @plugins.each_pair do | plugin, options | -%>
[<%= plugin %>]
<% 	unless options == nil -%>
<% 		options.each do | option, value | -%>
<%= 		option %> = <%= value %>
<% 		end -%>
<% 	end -%>
<% end -%>
